
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Руководство по установке и настройке OpenStack ‘Folsom’ &mdash; openstack 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="openstack 1.0 documentation" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'>
<link href="_static/solarized-dark.css" rel="stylesheet">
  </head>
  <body>
    <div class="related">
      <h3>Просмотр</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Словарь-указатель"
             accesskey="I">словарь</a></li>
        <li><a href="#">openstack 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Содержание</a></h3>
  <ul>
<li><a class="reference internal" href="#">Руководство по установке и настройке OpenStack &#8216;Folsom&#8217;</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#openstack">Компоненты Openstack</a><ul>
<li><a class="reference internal" href="#quantum">Quantum</a></li>
</ul>
</li>
</ul>

  <h3>На этой странице</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Показать исходный текст</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Быстрый поиск</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Искать" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Введите слова для поиска или имя модуля, класса или функции.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="openstack-folsom">
<h1>Руководство по установке и настройке OpenStack &#8216;Folsom&#8217;<a class="headerlink" href="#openstack-folsom" title="Ссылка на этот заголовок">¶</a></h1>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
</div>
<div class="section" id="openstack">
<h1>Компоненты Openstack<a class="headerlink" href="#openstack" title="Ссылка на этот заголовок">¶</a></h1>
<p><a class="reference external" href="http://www.openstack.org/">OpenStack</a> — это комплекс проектов свободного программного обеспечения, которое может быть использовано для создания вычислительных облаков и облачных хранилищ, как публичных, так и приватных (работающих только для обеспечения внутренних нужд компании). Эти проекты распространяются под лицензией Apache License.</p>
<p>Установка сервисов OpenStack будет производиться из пакетов, на основе операционной системы Ubuntu 12.04 «Precise», c использованием системы автоматизации процесса установки и настройки программного обеспечения Chef.</p>
<p>В данном руководстве рассмаривается структура облака, когда все облачные сервисы, кроме вычислительного, расположены на одном узле, называемом &#8220;контроллером облака&#8221;, к которому по локальной сети подключаются вычислительные узлы.</p>
<p>Вычислительный сервис nova-compute использует гипервизор <a class="reference external" href="http://www.linux-kvm.org/page/Main_Page">KVM</a></p>
<p>Для обеспечения живой миграции виртуальных машин используется сетевая файловая система NFS версии 3.</p>
<p>Публичным и приватным адресам вируальных машин с использованием <a class="reference external" href="http://mydns.bboy.net/">MyDns</a> автоматически выдаются доменные имена.</p>
<p>Хранилища образов, дисков виртуальных машин и объектов располагаются на LVM томах.</p>
<div class="section" id="quantum">
<h2>Quantum<a class="headerlink" href="#quantum" title="Ссылка на этот заголовок">¶</a></h2>
<div class="figure">
<img alt="_images/quantum.png" src="_images/quantum.png" />
</div>
<p>За работу с сетевой частью OpenStack отвечает библиотека Quantum, которая обеспечивает функцию «сеть как сервис» между сетевыми интерфейсами ВМ (vNIC) под управлением других сервисов OpenStack, фактически предоставляя API, позволяющее управлять всей сетевой частью облака. В зависимости от поставленных задач и спроектированной целевой конфигурации облака, к Quantum можно подключать плагины, такие как Open vSwith, Cisco UCS/Nexus, Linux Brige, NEC OpenFlow, Nicira Network Virtualization Platform (NVP) и некоторые другие.</p>
<p>Наиболее продвинутый вариант реализации сетевой инфраструктуры, в котором каждый(!) тенант получает приватный роутер, с возможностью создания дополнительных роутеров для каждого тенанта через Quantum API. Тенант может создавать свои сети, с возможностью подключения к роутеру. Теперь самое главное: данная схема позволяет каждому тенанту использовать любые сети, т.к. доступ вовне обеспечивается или через SNAT или Floating IPs. Иными словами, в облаке может быть несколько ВМ с одинаковыми(!) внутренними IP-адресами. Это может пригодиться, например, при переходе с одного облака на другое – запаковал машины, слил образ, настроил требуемую инфраструктуру на другом облаке, назначил IP-адреса, которые у тебя были ранее, развернул образы и все полетело без дополнительных изменений. Тот, кто часто вынужден был переносить сервера из одной подсети в другую, наверняка оценят эту возможность. С другой стороны, как часто вам может потребоваться таскать свою инфраструктуру между разными облаками?</p>
<p>Подготовка сетевых интерфейсов:</p>
<div class="highlight-python"><pre># VM internet Access
auto eth2
iface eth2 inet manual
up ifconfig $IFACE 0.0.0.0 up
up ip link set $IFACE promisc on
down ip link set $IFACE promisc off
down ifconfig $IFACE down

# OpenStack management
auto eth0
iface eth0 inet static
address 100.10.10.52
netmask 255.255.255.0

# VM Configuration
auto eth1
iface eth1 inet static
address 100.20.20.52
netmask 255.255.255.0

# Public interface
auto eth0
iface eth0 inet manual
up ifconfig $IFACE 0.0.0.0 up
up ip link set $IFACE promisc on
down ip link set $IFACE promisc off
down ifconfig $IFACE down

# Private interface
auto br-int
iface br-int inet static
        bridge_ports eth1
        address 10.10.10.1
        netmask 255.0.0.0</pre>
</div>
<p>В настоящем руководстве для установки компонентов облачной инфраструктуры OpenStack, мы будем использовать продукт <a class="reference external" href="http://www.opst.com/chef">OpstChef</a>. Это Open-Source инструмент управления инфраструктурой серверов. Мы будем рассматривать упрощенный вариант использования этого инструмента, без настройки Chef-сервера, а ограничимся использованием knife-solo.</p>
<p>Первым делом на управляющей машине необходимо установить менеджер пакетов для языка программирования Руби - RubyGems. В операционной системе Ubuntu сделать это можно c помощью стандартного пакетного менеджера командой:</p>
<p><tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">rubygems</span></tt></p>
<p><tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">gem-install</span> <span class="pre">knife-solo</span></tt></p>
<p><tt class="docutils literal"><span class="pre">knife</span> <span class="pre">configure</span> <span class="pre">-r</span> <span class="pre">.defaults</span></tt></p>
<div class="figure">
<img alt="_images/first.png" src="_images/first.png" />
</div>
<div class="figure">
<img alt="_images/second.png" src="_images/second.png" />
</div>
<p>Используемые скрипты для chef расчитаны на использование на будующих узлах облачной инфраструктуры опреационной системы Ubuntu версии 12.04, и налагает следующие требования:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">set</span><span class="p">[:</span><span class="n">mysql</span><span class="p">][:</span><span class="n">password</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;mySuperSecret&quot;</span>

<span class="nb">set</span><span class="p">[:</span><span class="n">controller</span><span class="p">][:</span><span class="n">private_ip</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;10.10.10.1&quot;</span>
<span class="nb">set</span><span class="p">[:</span><span class="n">controller</span><span class="p">][:</span><span class="n">public_ip</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;192.168.0.101&quot;</span>

<span class="nb">set</span><span class="p">[:</span><span class="n">keystone</span><span class="p">][:</span><span class="n">token</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;mySuperSecret&quot;</span>
<span class="nb">set</span><span class="p">[:</span><span class="n">keystone</span><span class="p">][:</span><span class="n">password</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;mySuperSecret&quot;</span>
<span class="nb">set</span><span class="p">[:</span><span class="n">keystone</span><span class="p">][:</span><span class="n">email</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;admin@post.domain.ru&quot;</span>

<span class="nb">set</span><span class="p">[:</span><span class="n">dns</span><span class="p">][:</span><span class="n">zone</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;cloud.domain.ru&quot;</span>
</pre></div>
</div>
<p>Работа с облачной системой OpenStack, помимо Web-интерфейса, может осуществляться с помощью <a class="reference external" href="http://pypi.python.org/pypi/python-novaclient">nova-client</a> или инструмента <a class="reference external" href="http://open.eucalyptus.com/wiki/Euca2oolsGuide">euca2ools</a>. В данном руководстве мы постараемся приводить команды для обоих этих инструментов.</p>
<p>Для использования команд nova, на клиентской машине необходимо установить пакет python-novaclient:</p>
<p><tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">python-novaclient</span></tt></p>
<p>и аутентифицироваться с помощью openrc файла для нужного проекта, который можно загрузить через Web-интерфейс, на вкладке settings</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Добавьте в файл openrc строчку export OS_NO_CACHE=1 это избавит Вас от необходимости каждый раз вводить пароль связки ключей, при использовании последней версии клиента</p>
</div>
<p>После загрузки файла выполните команду:</p>
<p><tt class="docutils literal"><span class="pre">source</span> <span class="pre">openrc.sh</span></tt></p>
<p>Для использования команд euca, на клиентской машине необходимо установить пакет euca2ools:</p>
<p><tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">euca2ools</span></tt></p>
<p>и аутентифицироваться с помощью сертификатов EC2. Скачайте zip-архив на странице настроек проекта, распакуйте файлы и выполните</p>
<p><tt class="docutils literal"><span class="pre">source</span> <span class="pre">ec2rc.sh</span></tt></p>
<p>Для запуска виртуальных в облачной инфраструктуре OpenStack используются образы дисков операционных систем. В последней версии Glance добавлена также возможность создания виртуальной машины и установки операционной системы из iso-образа. Мы рассмотрим два основных формата образов дисков:</p>
<blockquote>
<div><ul class="simple">
<li>AMI (англ. Amazon Machine Image). Образ операционной системы в этом формате состоит из трех частей: AKI (англ. Amazon Kernel Image) , ARI (англ. Amazon Ramdisk Image) AMI</li>
<li>QCOW2 - это формат дискового образа программы QEMU. Название является аббревиатурой названия формата Copy-On-Write (копирование при записи).</li>
</ul>
</div></blockquote>
<p>Первым шагом будет создание пустого файла образа диска. Современная операционная система семейства Windows требует для работы большое количество дискового пространства, не менее чем 20 GB.</p>
<p><tt class="docutils literal"><span class="pre">kvm-img</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">raw</span> <span class="pre">windowsserver.img</span> <span class="pre">20G</span></tt></p>
<p>Openstack использует интерфейс Virtio для дисков и сетевых адаптеров при запуске виртуальных машин. Это означает, что операционная система виртуальной машины должна иметь драйверы для Virtio. По умолчанию операционные машины семейства Windows не содержат таких драйверов, их необходимо предоставить операционной системе в процессе установки. Образ дискеты с последней версией необходимых драйверов доступен для скачивания c сайта <a class="reference external" href="http://alt.fedoraproject.org/pub/alt/virtio-win/latest/images/bin/">проекта fedora</a>
Процесс установки Windows можно запустить с помощью команды.</p>
<p><tt class="docutils literal"><span class="pre">kvm</span> <span class="pre">-m</span> <span class="pre">1024</span> <span class="pre">-cdrom</span> <span class="pre">windows.iso</span> <span class="pre">-drive</span> <span class="pre">file=windowsserver.img,</span> <span class="pre">if=virtio,boot=on</span> <span class="pre">-fda</span> <span class="pre">virtio-win-1.1.16.vfd</span> <span class="pre">-boot</span> <span class="pre">d</span> <span class="pre">-nographic</span> <span class="pre">-vnc</span> <span class="pre">:0</span></tt></p>
<p>Здесь параметром cdrom указывается путь к образу установочного диска операционной системы, например windows.iso. Параметр drive - предварительно созданный образ жесткого диска. Параметром fda задается путь к загруженному образу дискеты с драйверами windows.
После запуска команды начнется стандартный процесс установки Windows. К Консоли управления можно подключиться с помощью любого обозревателя VNC, например vncviewer:</p>
<p><tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">vncviewer</span> <span class="pre">-y</span></tt></p>
<p>на порт 5900.</p>
<p><tt class="docutils literal"><span class="pre">vncviewer</span> <span class="pre">localhost:5900</span></tt></p>
<p>Если создание образа производится на удаленной машине, подключиться к VNC-консоли можно с использованием ssh-туннеля, например так:</p>
<p><tt class="docutils literal"><span class="pre">vncviewer</span> <span class="pre">-via</span> <span class="pre">&quot;laboshinl&#64;192.168.0.100</span> <span class="pre">-p</span> <span class="pre">22&quot;</span> <span class="pre">localhost:0</span></tt></p>
<p>Необходимо следовать инструкциям, появляющимся на экране. В процессе установки в окне выбора жесткий диск, не будет выведено каких-либо устройств. Необходимо нажать на кнопку &#8220;Загрузить драйверы&#8221;, в левом нижнем углу и указать путь к подключенным драйверам после чего продолжить установку</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Для удобства дальнейшего использования образа рекомендуется после завершения установки разрешить удаленное администрирование системы через RDP(RemoteDesktopProtocol)</p>
</div>
<p><a class="reference external" href="https://launchpad.net/cirros/trunk/0.3.0/">Тестовые образы от Cirros</a></p>
<p><a class="reference external" href="http://uec-images.ubuntu.com/">Официальные образы релизов Ubuntu</a></p>
<p>Готовые образы некоторых операционных систем доступны так же на сайте <a class="reference external" href="http://xenlet.stu.neva.ru">нашего проекта</a></p>
<p><tt class="docutils literal"><span class="pre">nova</span> <span class="pre">cloudpipe-create</span> <span class="pre">$project_ID</span></tt></p>
<p>Шаблон конфирурационного файла для openvpn</p>
<div class="highlight-python"><pre># Edit the following lines to point to your cert files:
cert cert.pem
key pk.pem

ca cacert.pem

client
dev tap
proto udp

remote $controller_public_ip $port
resolv-retry infinite
nobind

# Downgrade privileges after initialization (non-Windows only)
user nobody
group nogroup
comp-lzo

# Set log file verbosity.
verb 2

keepalive 10 120
ping-timer-rem
persist-tun
persist-key</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Просмотр</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Словарь-указатель"
             >словарь</a></li>
        <li><a href="#">openstack 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Леонид Лабошин.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.Theme by <a href="http://github.com/vkvn">vkvn</a>
    </div>
  </body>
</html>