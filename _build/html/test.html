
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Ручная установка &mdash; openstack 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.0/css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.0/css/bootstrap-responsive.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-2.3.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="openstack 1.0 documentation" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>
<div class="container">
  
  <div id="navbar" class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner"><div class="container">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="brand" href="openstack-grizzly-guide.html">OpenStack</a>
      <span class="navbar-text pull-left"><b>Grizzly</b></span>

      <div class="nav-collapse">
        <ul class="nav">
          <li class="divider-vertical"></li>
          
            <li class="dropdown globaltoc-container">
  <a href="openstack-grizzly-guide.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Страницы <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul>
<li class="toctree-l1"><a class="reference internal" href="openstack-grizzly-installation-prerequisites.html">Подготовка к установке</a></li>
<li class="toctree-l1"><a class="reference internal" href="openstack-grizzly-manual-installation.html">Ручная установка</a><ul>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly-manual-installation.html#id2">Установка контроллера облака</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly-manual-installation.html#id11">Добавление вычислительных узлов</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="openstack-grizzly-automatic-installation.html">Автоматическая установка</a><ul>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly-automatic-installation.html#id2">Подготовка управляющего компьютера</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly-automatic-installation.html#id3">Установка контроллера облака</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly-automatic-installation.html#id4">Добавление вычислительных узлов</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="openstack-grizzly-usage.html">Работа с системой</a><ul>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly-usage.html#id2">Образы виртуальных машин</a></li>
<li class="toctree-l2"><a class="reference internal" href="openstack-grizzly-usage.html#cloudpipe">Cloudpipe</a></li>
</ul>
</li>
</ul>
</ul>
</li>
            <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Навигация <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Ручная установка</a><ul>
<li><a class="reference internal" href="#id2">Подготовка к установке</a><ul>
<li><a class="reference internal" href="#id3">Структура облака</a></li>
<li><a class="reference internal" href="#id4">Подготовка узлов</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ceph">CEPH</a></li>
<li><a class="reference internal" href="#keystone">Keystone</a><ul>
<li><a class="reference internal" href="#id8">Установка</a></li>
<li><a class="reference internal" href="#id9">Использование</a></li>
</ul>
</li>
<li><a class="reference internal" href="#glance">Glance</a><ul>
<li><a class="reference internal" href="#id11">Установка</a></li>
<li><a class="reference internal" href="#id12">Команды Glance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nova">Nova</a><ul>
<li><a class="reference internal" href="#id14">Установка</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cinder">Cinder</a><ul>
<li><a class="reference internal" href="#id16">Установка</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dashboard">Dashboard</a><ul>
<li><a class="reference internal" href="#id17">Установка</a></li>
</ul>
</li>
<li><a class="reference internal" href="#quantum">Quantum</a><ul>
<li><a class="reference internal" href="#id19">Установка</a></li>
</ul>
</li>
<li><a class="reference internal" href="#swift">Swift</a><ul>
<li><a class="reference internal" href="#id21">Установка</a></li>
</ul>
</li>
<li><a class="reference internal" href="#munin">Munin</a></li>
<li><a class="reference internal" href="#names">MyDNS</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          
          
            
          
        </ul>

        
          
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Поиск" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>
</div>

  
  <div class="section" id="id1">
<h1>Ручная установка<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h1>
<p><a class="reference external" href="http://www.openstack.org/">OpenStack</a> — это комплекс проектов свободного (<a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>) программного обеспечения, предназначенного для создания вычислительных облаков и облачных хранилищ.</p>
<p>На сегодняшний день OpenStack содержит семь ключевых компонентов:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#keystone"><em>Сервис авторизации и аутентификации «Keystone»</em></a></li>
<li><a class="reference internal" href="#glance"><em>Хранилище образов «Glance»</em></a></li>
<li><a class="reference internal" href="#nova"><em>Вычислительный сервис «Nova»</em></a></li>
<li><a class="reference internal" href="#quantum"><em>Сетевой сервис Quantum</em></a></li>
<li><a class="reference internal" href="#cinder"><em>Сервис хранения блоков данных «Cinder»</em></a></li>
<li><a class="reference internal" href="#swift"><em>Хранилище объектов «Swift»</em></a></li>
<li><a class="reference internal" href="#horizon"><em>Веб-интерфейс «Horizon»</em></a></li>
</ul>
</div></blockquote>
<p>В данное руководство так же включена установка</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#filesystem"><em>Распределенной файловой системы CEPH</em></a></li>
<li><a class="reference internal" href="#munin"><em>Cистемы мониторинга Munin</em></a></li>
<li><a class="reference internal" href="#names"><em>Сервера доменных имен MyDNS</em></a></li>
</ul>
</div></blockquote>
<div class="section" id="id2">
<h2>Подготовка к установке<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="id3">
<h3>Структура облака<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h3>
<div class="figure align-center">
<img alt="_images/first.png" src="_images/first.png" />
</div>
</div>
<div class="section" id="id4">
<h3>Подготовка узлов<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h3>
<p>Установка сервисов OpenStack будет производиться из пакетов, на основе операционной системы Ubuntu 12.04 «Precise», c использованием системы автоматизации процесса установки и настройки программного обеспечения Chef.</p>
<p>В данном руководстве рассмаривается структура облака, когда все облачные сервисы, кроме вычислительного, расположены на одном узле, называемом &#8220;контроллером облака&#8221;, к которому по локальной сети подключаются вычислительные узлы.</p>
<p>Вычислительный сервис nova-compute использует гипервизор <a class="reference external" href="http://www.linux-kvm.org/page/Main_Page">KVM</a></p>
<p>Публичным и приватным адресам вируальных машин с использованием <a class="reference external" href="http://mydns.bboy.net/">MyDns</a> автоматически выдаются доменные имена.</p>
<p>Хранилища образов, дисков виртуальных машин и объектов располагаются на LVM томах.</p>
<p>Наиболее продвинутый вариант реализации сетевой инфраструктуры, в котором каждый(!) тенант получает приватный роутер, с возможностью создания дополнительных роутеров для каждого тенанта через Quantum API. Тенант может создавать свои сети, с возможностью подключения к роутеру. Теперь самое главное: данная схема позволяет каждому тенанту использовать любые сети, т.к. доступ вовне обеспечивается или через SNAT или Floating IPs. Иными словами, в облаке может быть несколько ВМ с одинаковыми(!) внутренними IP-адресами. Это может пригодиться, например, при переходе с одного облака на другое – запаковал машины, слил образ, настроил требуемую инфраструктуру на другом облаке, назначил IP-адреса, которые у тебя были ранее, развернул образы и все полетело без дополнительных изменений. Тот, кто часто вынужден был переносить сервера из одной подсети в другую, наверняка оценят эту возможность. С другой стороны, как часто вам может потребоваться таскать свою инфраструктуру между разными облаками?</p>
<p>Подготовка сетевых интерфейсов:</p>
<div class="highlight-python"><pre># Public interface
auto eth0
iface eth0 inet static
address 195.208.117.140
netmask 255.255.255.224

# Private interface
auto br-int
iface br-int inet static
        bridge_ports eth1
        address 10.10.10.0
        netmask 255.0.0.0</pre>
</div>
<p>В настоящем руководстве для установки компонентов облачной инфраструктуры OpenStack, мы будем использовать продукт <a class="reference external" href="http://www.opst.com/chef">OpstChef</a>. Это Open-Source инструмент управления инфраструктурой серверов. Мы будем рассматривать упрощенный вариант использования этого инструмента, без настройки Chef-сервера, а ограничимся использованием knife-solo.</p>
<p>Первым делом на управляющей машине необходимо установить менеджер пакетов для языка программирования Руби - RubyGems. В операционной системе Ubuntu сделать это можно c помощью стандартного пакетного менеджера командой:</p>
<p><tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">rubygems</span> <span class="pre">git</span></tt></p>
<p><tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">gem-install</span> <span class="pre">knife-solo</span></tt></p>
<p><tt class="docutils literal"><span class="pre">knife</span> <span class="pre">configure</span> <span class="pre">-r</span> <span class="pre">.defaults</span></tt></p>
<p><tt class="docutils literal"><span class="pre">knife</span> <span class="pre">solo</span> <span class="pre">init</span> <span class="pre">openstack</span></tt></p>
<p><tt class="docutils literal"><span class="pre">cd</span> <span class="pre">openstack</span></tt></p>
<p><tt class="docutils literal"><span class="pre">rm</span> <span class="pre">cookbooks</span> <span class="pre">-r</span></tt></p>
<p><tt class="docutils literal"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/laboshinl/grizzly.git</span> <span class="pre">cookbooks</span></tt></p>
<p><tt class="docutils literal"><span class="pre">knife</span> <span class="pre">solo</span> <span class="pre">prepare</span> <span class="pre">root&#64;npc11.stu.neva.ru</span></tt></p>
<p>Используемые скрипты для chef расчитаны на использование на будующих узлах облачной инфраструктуры опреационной системы Ubuntu версии 12.04, и налагает следующие требования:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">set</span><span class="p">[:</span><span class="n">mysql</span><span class="p">][:</span><span class="n">password</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;mySuperSecret&quot;</span>

<span class="nb">set</span><span class="p">[:</span><span class="n">controller</span><span class="p">][:</span><span class="n">private_ip</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;10.10.10.1&quot;</span>
<span class="nb">set</span><span class="p">[:</span><span class="n">controller</span><span class="p">][:</span><span class="n">public_ip</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;192.168.0.101&quot;</span>

<span class="nb">set</span><span class="p">[:</span><span class="n">keystone</span><span class="p">][:</span><span class="n">token</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;mySuperSecret&quot;</span>
<span class="nb">set</span><span class="p">[:</span><span class="n">keystone</span><span class="p">][:</span><span class="n">password</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;mySuperSecret&quot;</span>
<span class="nb">set</span><span class="p">[:</span><span class="n">keystone</span><span class="p">][:</span><span class="n">email</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;admin@post.domain.ru&quot;</span>

<span class="nb">set</span><span class="p">[:</span><span class="n">dns</span><span class="p">][:</span><span class="n">zone</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;cloud.domain.ru&quot;</span>
</pre></div>
</div>
<p>Работа с облачной системой OpenStack, помимо Web-интерфейса, может осуществляться с помощью <a class="reference external" href="http://pypi.python.org/pypi/python-novaclient">nova-client</a> или инструмента <a class="reference external" href="http://open.eucalyptus.com/wiki/Euca2oolsGuide">euca2ools</a>. В данном руководстве мы постараемся приводить команды для обоих этих инструментов.</p>
<p>Для использования команд nova, на клиентской машине необходимо установить пакет python-novaclient:</p>
<p><tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">python-novaclient</span></tt></p>
<p>и аутентифицироваться с помощью openrc файла для нужного проекта, который можно загрузить через Web-интерфейс, на вкладке settings</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Добавьте в файл openrc строчку <strong>export OS_NO_CACHE=1</strong> это избавит Вас от необходимости каждый раз вводить пароль связки ключей, при использовании последней версии клиента</p>
</div>
<p>После загрузки файла выполните команду:</p>
<p><tt class="docutils literal"><span class="pre">source</span> <span class="pre">openrc.sh</span></tt></p>
<p>Для использования команд euca, на клиентской машине необходимо установить пакет euca2ools:</p>
<p><tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">euca2ools</span></tt></p>
<p>и аутентифицироваться с помощью сертификатов EC2. Скачайте zip-архив на странице настроек проекта, распакуйте файлы и выполните</p>
<p><tt class="docutils literal"><span class="pre">source</span> <span class="pre">ec2rc.sh</span></tt></p>
<p>Для запуска виртуальных в облачной инфраструктуре OpenStack используются образы дисков операционных систем. В последней версии Glance добавлена также возможность создания виртуальной машины и установки операционной системы из iso-образа. Мы рассмотрим два основных формата образов дисков:</p>
<blockquote>
<div><ul class="simple">
<li>AMI (англ. Amazon Machine Image). Образ операционной системы в этом формате состоит из трех частей: AKI (англ. Amazon Kernel Image) , ARI (англ. Amazon Ramdisk Image) AMI</li>
<li>QCOW2 - это формат дискового образа программы QEMU. Название является аббревиатурой названия формата Copy-On-Write (копирование при записи).</li>
</ul>
</div></blockquote>
<p>Первым шагом будет создание пустого файла образа диска. Современная операционная система семейства Windows требует для работы большое количество дискового пространства, не менее чем 20 GB.</p>
<p><tt class="docutils literal"><span class="pre">kvm-img</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">raw</span> <span class="pre">windowsserver.img</span> <span class="pre">20G</span></tt></p>
<p>Openstack использует интерфейс Virtio для дисков и сетевых адаптеров при запуске виртуальных машин. Это означает, что операционная система виртуальной машины должна иметь драйверы для Virtio. По умолчанию операционные машины семейства Windows не содержат таких драйверов, их необходимо предоставить операционной системе в процессе установки. Образ дискеты с последней версией необходимых драйверов доступен для скачивания c сайта <a class="reference external" href="http://alt.fedoraproject.org/pub/alt/virtio-win/latest/images/bin/">проекта fedora</a>
Процесс установки Windows можно запустить с помощью команды.</p>
<p><tt class="docutils literal"><span class="pre">kvm</span> <span class="pre">-m</span> <span class="pre">1024</span> <span class="pre">-cdrom</span> <span class="pre">windows.iso</span> <span class="pre">-drive</span> <span class="pre">file=windowsserver.img,</span> <span class="pre">if=virtio,boot=on</span> <span class="pre">-fda</span> <span class="pre">virtio-win-1.1.16.vfd</span> <span class="pre">-boot</span> <span class="pre">d</span> <span class="pre">-nographic</span> <span class="pre">-vnc</span> <span class="pre">:0</span></tt></p>
<p>Здесь параметром cdrom указывается путь к образу установочного диска операционной системы, например windows.iso. Параметр drive - предварительно созданный образ жесткого диска. Параметром fda задается путь к загруженному образу дискеты с драйверами windows.
После запуска команды начнется стандартный процесс установки Windows. К Консоли управления можно подключиться с помощью любого обозревателя VNC, например vncviewer:</p>
<p><tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">vncviewer</span> <span class="pre">-y</span></tt></p>
<p>на порт 5900.</p>
<p><tt class="docutils literal"><span class="pre">vncviewer</span> <span class="pre">localhost:5900</span></tt></p>
<p>Если создание образа производится на удаленной машине, подключиться к VNC-консоли можно с использованием ssh-туннеля, например так:</p>
<p><tt class="docutils literal"><span class="pre">vncviewer</span> <span class="pre">-via</span> <span class="pre">&quot;laboshinl&#64;192.168.0.100</span> <span class="pre">-p</span> <span class="pre">22&quot;</span> <span class="pre">localhost:0</span></tt></p>
<p>Необходимо следовать инструкциям, появляющимся на экране. В процессе установки в окне выбора жесткий диск, не будет выведено каких-либо устройств. Необходимо нажать на кнопку &#8220;Загрузить драйверы&#8221;, в левом нижнем углу и указать путь к подключенным драйверам после чего продолжить установку</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Для удобства дальнейшего использования образа рекомендуется после завершения установки разрешить удаленное администрирование системы через RDP(RemoteDesktopProtocol)</p>
</div>
<p><a class="reference external" href="https://launchpad.net/cirros/trunk/0.3.0/">Тестовые образы от Cirros</a></p>
<p><a class="reference external" href="http://uec-images.ubuntu.com/">Официальные образы релизов Ubuntu</a></p>
<p>Готовые образы некоторых операционных систем доступны так же на сайте <a class="reference external" href="http://xenlet.stu.neva.ru">нашего проекта</a></p>
<p><tt class="docutils literal"><span class="pre">nova</span> <span class="pre">cloudpipe-create</span> <span class="pre">$project_ID</span></tt></p>
<p>Шаблон конфирурационного файла для openvpn</p>
<div class="highlight-python"><pre># Edit the following lines to point to your cert files:
cert cert.pem
key pk.pem

ca cacert.pem

client
dev tap
proto udp

remote $controller_public_ip $port
resolv-retry infinite
nobind

# Downgrade privileges after initialization (non-Windows only)
user nobody
group nogroup
comp-lzo

# Set log file verbosity.
verb 2

keepalive 10 120
ping-timer-rem
persist-tun
persist-key</pre>
</div>
</div>
</div>
<div class="section" id="ceph">
<span id="filesystem"></span><h2>CEPH<a class="headerlink" href="#ceph" title="Ссылка на этот заголовок">¶</a></h2>
<p><a class="reference external" href="http://ceph.com">Ceph</a> — свободная распределённая файловая система. Ceph может использоваться на системах, состоящих как из нескольких машин, так и из тысяч узлов. Общий объем хранилища данных может измеряться петабайтами, встроенные механизмы продублированной репликации данных (не зависит от отказа отдельных узлов) обеспечивают чрезвычайно высокую живучесть системы, при добавлении или удалении новых узлов, массив данных автоматически перебалансируется с учетом новшеств.</p>
<p>Установка</p>
<p><tt class="docutils literal"><span class="pre">#</span> <span class="pre">gpg</span> <span class="pre">--keyserver</span> <span class="pre">keyserver.ubuntu.com</span> <span class="pre">--recv</span> <span class="pre">17ED316D</span></tt></p>
<p><tt class="docutils literal"><span class="pre">#</span> <span class="pre">gpg</span> <span class="pre">--export</span> <span class="pre">--armor</span> <span class="pre">17ED316D</span> <span class="pre">|</span> <span class="pre">apt-key</span> <span class="pre">add</span> <span class="pre">-</span></tt></p>
<p><tt class="docutils literal"><span class="pre">#</span> <span class="pre">apt-get</span> <span class="pre">update</span></tt></p>
<p><tt class="docutils literal"><span class="pre">#</span> <span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">ceph</span></tt></p>
<p>Необходимо добавить репозиторий &#8220;Grizzly&#8221;</p>
<p><tt class="docutils literal"><span class="pre">echo</span> <span class="pre">&quot;deb</span> <span class="pre">http://ppa.launchpad.net/openstack-ubuntu-testing/grizzly-trunk-testing/ubuntu/</span> <span class="pre">precise</span> <span class="pre">main&quot;</span> <span class="pre">&gt;&gt;</span> <span class="pre">/etc/apt/sources.list</span></tt></p>
<p>Получение ключа</p>
<p><tt class="docutils literal"><span class="pre">gpg</span> <span class="pre">--keyserver</span> <span class="pre">keyserver.ubuntu.com</span> <span class="pre">--recv</span> <span class="pre">3B6F61A6</span> <span class="pre">&amp;&amp;</span> <span class="pre">gpg</span> <span class="pre">--export</span> <span class="pre">--armor</span> <span class="pre">3B6F61A6</span> <span class="pre">|</span> <span class="pre">apt-key</span> <span class="pre">add</span> <span class="pre">-</span></tt></p>
<p>Обновление списка пакетов</p>
<p><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">update</span></tt></p>
<p><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">mysql-server</span> <span class="pre">python-mysqldb</span> <span class="pre">-y</span></tt></p>
<p><tt class="docutils literal"><span class="pre">sed</span> <span class="pre">-i</span> <span class="pre">'s/127.0.0.1/10.10.10.0/g'</span> <span class="pre">/etc/mysql/my.cnf</span></tt></p>
<div class="admonition hint">
<p class="first admonition-title">Подсказка</p>
<p class="last">Здесь <strong>10.10.10.0</strong> ip-адрес сетевого интерфейса во внутренней сети</p>
</div>
<p><tt class="docutils literal"><span class="pre">service</span> <span class="pre">mysql</span> <span class="pre">restart</span></tt></p>
<p><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">rabbitmq-server</span></tt></p>
</div>
<div class="section" id="keystone">
<span id="id7"></span><h2>Keystone<a class="headerlink" href="#keystone" title="Ссылка на этот заголовок">¶</a></h2>
<p>Keystone provides a single point of integration for OpenStack policy, catalog, token and authentication.</p>
<blockquote>
<div><ul class="simple">
<li>keystone handles API requests as well as providing configurable catalog, policy, token and identity services.</li>
<li>Each Keystone function has a pluggable backend which allows different ways to use the particular service. Most support standard backends like LDAP or SQL, as well as Key Value Stores (KVS).</li>
</ul>
</div></blockquote>
<p>Most people will use this as a point of customization for their current authentication services.</p>
<div class="section" id="id8">
<h3>Установка<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">keystone</span></tt></p>
<p><tt class="docutils literal"><span class="pre">mysql</span> <span class="pre">-uroot</span> <span class="pre">-pMysqlPass</span> <span class="pre">-e</span> <span class="pre">&quot;CREATE</span> <span class="pre">DATABASE</span> <span class="pre">keystone;&quot;</span></tt></p>
<p><tt class="docutils literal"><span class="pre">mysql</span> <span class="pre">-uroot</span> <span class="pre">-pMysqlPass</span> <span class="pre">-e</span> <span class="pre">&quot;GRANT</span> <span class="pre">ALL</span> <span class="pre">PRIVILEGES</span> <span class="pre">ON</span> <span class="pre">*.*</span> <span class="pre">TO</span> <span class="pre">'root'&#64;'%'</span> <span class="pre">IDENTIFIED</span> <span class="pre">BY</span> <span class="pre">'MysqlPass';&quot;</span></tt></p>
<div class="admonition hint">
<p class="first admonition-title">Подсказка</p>
<p class="last">Здесь и далее <strong>MysqlPass</strong> - пароль, введенный при установке пакета mysql-server</p>
</div>
<p>В конфигурационном файле /etc/keystone/keystone.conf необходимо:</p>
<blockquote>
<div><ul>
<li><p class="first">раскоментировать строчку и изменить токен в секции [DEFAULT]:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">admin_token</span> <span class="o">=</span> <span class="n">AdminToken</span>
</pre></div>
</div>
</li>
<li><p class="first">в секции [sql] указать путь к созданной базе данных:</p>
<div class="highlight-python"><pre>connection = mysql://root:MysqlPass@10.10.10.0/keystone</pre>
</div>
</li>
<li><p class="first">секцию [catalog] привести к следующему виду:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># dynamic, sql-based backend (supports API/CLI-based management commands)</span>
<span class="c"># driver = keystone.catalog.backends.sql.Catalog</span>

<span class="c"># static, file-based backend (does *NOT* support any management commands)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">keystone</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">templated</span><span class="o">.</span><span class="n">TemplatedCatalog</span>
<span class="n">template_file</span> <span class="o">=</span> <span class="n">default_catalog</span><span class="o">.</span><span class="n">templates</span>
</pre></div>
</div>
</li>
<li><p class="first">в секции [signing]:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">token_format</span> <span class="o">=</span> <span class="n">UUID</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>Перезапуск сервиса</p>
<p><tt class="docutils literal"><span class="pre">service</span> <span class="pre">keystone</span> <span class="pre">restart</span></tt></p>
<p>Синхронизация с базой данных</p>
<p><tt class="docutils literal"><span class="pre">keystone-manage</span> <span class="pre">db_sync</span></tt></p>
<p>Аутентификация</p>
<p><tt class="docutils literal"><span class="pre">export</span> <span class="pre">SERVICE_TOKEN=AdminToken</span></tt></p>
<p><tt class="docutils literal"><span class="pre">export</span> <span class="pre">SERVICE_ENDPOINT=&quot;http://10.10.10.0:35357/v2.0&quot;</span></tt></p>
<p>Для дальнейшей работы необходимо создать два проекта. Проект, роль, и пользователь <strong>admin</strong>, необходим для функционирования сервисов и администрирования облака.</p>
<p><tt class="docutils literal"><span class="pre">keystone</span> <span class="pre">tenant-create</span> <span class="pre">--name=admin</span></tt></p>
<div class="highlight-python"><pre>+-------------+----------------------------------+
|   Property  |              Value               |
+-------------+----------------------------------+
| description |                                  |
|   enabled   |               True               |
|      id     | 1f155208db0a4c959365a0002b8b507e |
|     name    |              admin               |
+-------------+----------------------------------+</pre>
</div>
<p><tt class="docutils literal"><span class="pre">keystone</span> <span class="pre">user-create</span> <span class="pre">--name=admin</span> <span class="pre">--pass=cl0udAdmin</span> <span class="pre">--email=cloud&#64;admin.com</span></tt></p>
<div class="highlight-python"><pre>+----------+----------------------------------+
| Property |              Value               |
+----------+----------------------------------+
|  email   |         cloud@admin.com          |
| enabled  |               True               |
|    id    | 1d2a73ea87f249769f6669ee2f812932 |
|   name   |              admin               |
| tenantId |                                  |
+----------+----------------------------------+</pre>
</div>
<p><tt class="docutils literal"><span class="pre">keystone</span> <span class="pre">role-create</span> <span class="pre">--name=admin</span></tt></p>
<div class="highlight-python"><pre>+----------+----------------------------------+
| Property |              Value               |
+----------+----------------------------------+
|    id    | 424f7b79893c4266bf5753894a4668d2 |
|   name   |              admin               |
+----------+----------------------------------+</pre>
</div>
<p><tt class="docutils literal"><span class="pre">keystone</span> <span class="pre">user-role-add</span> <span class="pre">--user-id</span> <span class="pre">1d2a73ea87f249769f6669ee2f812932</span> <span class="pre">--role-id</span> <span class="pre">424f7b79893c4266bf5753894a4668d2</span> <span class="pre">--tenant-id</span> <span class="pre">1f155208db0a4c959365a0002b8b507e</span></tt></p>
<p>Роль <strong>Member</strong> - роль по умолчанию для добавления пользователей облака. Пользователь <strong>tester</strong> и проект <strong>test</strong> необходимы для проверки работы сервисов облачной инфраструктуры после установки.</p>
<p><tt class="docutils literal"><span class="pre">keystone</span> <span class="pre">tenant-create</span> <span class="pre">--name=test</span></tt></p>
<div class="highlight-python"><pre>+-------------+----------------------------------+
|   Property  |              Value               |
+-------------+----------------------------------+
| description |                                  |
|   enabled   |               True               |
|      id     | 37cfbd624d0242b995fa695d8b134bb6 |
|     name    |               test               |
+-------------+----------------------------------+</pre>
</div>
<p><tt class="docutils literal"><span class="pre">keystone</span> <span class="pre">user-create</span> <span class="pre">--name=tester</span> <span class="pre">--pass=cl0udAdmin</span> <span class="pre">--email=cloud&#64;admin.com</span></tt></p>
<div class="highlight-python"><pre>+----------+----------------------------------+
| Property |              Value               |
+----------+----------------------------------+
|  email   |         cloud@admin.com          |
| enabled  |               True               |
|    id    | cf0828666bfd4a24b12dcd83848ef360 |
|   name   |              tester              |
| tenantId |                                  |
+----------+----------------------------------+</pre>
</div>
<p><tt class="docutils literal"><span class="pre">keystone</span> <span class="pre">role-create</span> <span class="pre">--name=Member</span></tt></p>
<div class="highlight-python"><pre>+----------+----------------------------------+
| Property |              Value               |
+----------+----------------------------------+
|    id    | 01242eec84c14106a10759e210c98dee |
|   name   |              Member              |
+----------+----------------------------------+</pre>
</div>
<p><tt class="docutils literal"><span class="pre">keystone</span> <span class="pre">user-role-add</span> <span class="pre">--user-id</span> <span class="pre">cf0828666bfd4a24b12dcd83848ef360</span> <span class="pre">--role-id</span> <span class="pre">01242eec84c14106a10759e210c98dee</span> <span class="pre">--tenant-id</span> <span class="pre">37cfbd624d0242b995fa695d8b134bb6</span></tt></p>
<p>Файл /etc/keystone/default_catalog.templates необходимо привести к следующему виду</p>
<div class="highlight-python"><pre># config for TemplatedCatalog, using camelCase because I don't want to do
# translations for keystone compat
catalog.RegionOne.identity.publicURL = http://195.208.117.140:$(public_port)s/v2.0
catalog.RegionOne.identity.adminURL = http://195.208.117.140:$(admin_port)s/v2.0
catalog.RegionOne.identity.internalURL = http://195.208.117.140:$(public_port)s/v2.0
catalog.RegionOne.identity.name = Identity Service

# fake compute service for now to help novaclient tests work
catalog.RegionOne.compute.publicURL = http://195.208.117.140:$(compute_port)s/v1.1/$(tenant_id)s
catalog.RegionOne.compute.adminURL = http://195.208.117.140:$(compute_port)s/v1.1/$(tenant_id)s
catalog.RegionOne.compute.internalURL = http://195.208.117.140:$(compute_port)s/v1.1/$(tenant_id)s
catalog.RegionOne.compute.name = Compute Service

catalog.RegionOne.volume.publicURL = http://195.208.117.140:8776/v1/$(tenant_id)s
catalog.RegionOne.volume.adminURL = http://195.208.117.140:8776/v1/$(tenant_id)s
catalog.RegionOne.volume.internalURL = http://195.208.117.140:8776/v1/$(tenant_id)s
catalog.RegionOne.volume.name = Volume Service

catalog.RegionOne.ec2.publicURL = http://195.208.117.140:8773/services/Cloud
catalog.RegionOne.ec2.adminURL = http://195.208.117.140:8773/services/Admin
catalog.RegionOne.ec2.internalURL = http://195.208.117.140:8773/services/Cloud
catalog.RegionOne.ec2.name = EC2 Service

catalog.RegionOne.image.publicURL = http://195.208.117.140:9292/v1
catalog.RegionOne.image.adminURL = http://195.208.117.140:9292/v1
catalog.RegionOne.image.internalURL = http://195.208.117.140:9292/v1
catalog.RegionOne.image.name = Image Service

catalog.RegionOne.network.publicURL = http://195.208.117.140:9696
catalog.RegionOne.network.adminURL = http://195.208.117.140:9696
catalog.RegionOne.network.internalURL = http://195.208.117.140:9696
catalog.RegionOne.network.name = Network Service

catalog.RegionOne.object_store.publicURL = http://195.208.117.140:8080/v1/AUTH_$(tenant_id)s
catalog.RegionOne.object_store.adminURL = http://195.208.117.140:8080/
catalog.RegionOne.object_store.internalURL = http://195.208.117.140:8080/v1/AUTH_$(tenant_id)s
catalog.RegionOne.object_store.name = S3 Service</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Здесь и далее <strong>195.208.117.140</strong> ip-адрес сетевого интерфейса контроллера облака во внешней сети</p>
</div>
</div>
<div class="section" id="id9">
<h3>Использование<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">keystone</span> <span class="pre">user-list</span></tt></p>
<div class="highlight-python"><pre>+----------------------------------+--------+---------+-----------------+
|                id                |  name  | enabled |      email      |
+----------------------------------+--------+---------+-----------------+
| 1d2a73ea87f249769f6669ee2f812932 | admin  |   True  | cloud@admin.com |
| cf0828666bfd4a24b12dcd83848ef360 | tester |   True  | cloud@admin.com |
+----------------------------------+--------+---------+-----------------+</pre>
</div>
</div>
</div>
<div class="section" id="glance">
<span id="id10"></span><h2>Glance<a class="headerlink" href="#glance" title="Ссылка на этот заголовок">¶</a></h2>
<p>The Glance architecture has stayed relatively stable since the Cactus release. The biggest architectural change has been the addition of authentication, which was added in the Diablo release. Just as a quick reminder, Glance has four main parts to it:</p>
<blockquote>
<div><ul class="simple">
<li>glance-api accepts Image API calls for image discovery, image retrieval and image storage.</li>
<li>glance-registry stores, processes and retrieves metadata about images (size, type, etc.).</li>
<li>A database to store the image metadata. Like Nova, you can choose your database depending on your preference (but most people use MySQL or SQlite).</li>
<li>A storage repository for the actual image files. In the diagram above, Swift is shown as the image repository, but this is configurable. In addition to Swift, Glance supports normal filesystems, RADOS block devices, Amazon S3 and HTTP. Be aware that some of these choices are limited to read-only usage.</li>
</ul>
</div></blockquote>
<p>There are also a number of periodic process which run on Glance to support caching. The most important of these is the replication services, which ensures consistency and availability through the cluster. Other periodic processes include auditors, updaters and reapers.</p>
<p>As you can see from the diagram in the Conceptual Architecture section, Glance serves a central role to the overall IaaS picture. It accepts API requests for images (or image metadata) from end users or Nova components and can store its disk files in the object storage service, Swift.</p>
<div class="section" id="id11">
<h3>Установка<a class="headerlink" href="#id11" title="Ссылка на этот заголовок">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">glance</span></tt></p>
<p><tt class="docutils literal"><span class="pre">mysql</span> <span class="pre">-uroot</span> <span class="pre">-pMysqlPass</span> <span class="pre">-e</span> <span class="pre">&quot;CREATE</span> <span class="pre">DATABASE</span> <span class="pre">glance;&quot;</span></tt></p>
<p>В конфигурационных файлах /etc/glance glance-api.conf и /etc/glance/glance-registry.conf необходимо изменить:</p>
<div class="highlight-python"><pre>[DEFAULT]
sql_connection = mysql://root@MysqlPass@10.10.10.0/glance

[keystone_authtoken]
auth_host = 127.0.0.1
auth_port = 35357
auth_protocol = http
admin_tenant_name = admin
admin_user = admin
admin_password = cl0udAdmin

[paste_deploy]
flavor = keystone</pre>
</div>
<p><tt class="docutils literal"><span class="pre">service</span> <span class="pre">glance-api</span> <span class="pre">restart</span></tt></p>
<p><tt class="docutils literal"><span class="pre">service</span> <span class="pre">glance-registry</span> <span class="pre">restart</span></tt></p>
<p><tt class="docutils literal"><span class="pre">glance-manage</span> <span class="pre">db_sync</span></tt></p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Glance требует версию пакета warlock&gt;=0.7.0,&lt;2 а в репозитории Ubuntu &#8216;Precise&#8217; версия 0.1.0, необходимо установить свежую версию с помощью pip install</p>
</div>
<p><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">python-pip</span></tt></p>
<p><tt class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">warlock</span> <span class="pre">--upgrade</span></tt></p>
</div>
<div class="section" id="id12">
<h3>Команды Glance<a class="headerlink" href="#id12" title="Ссылка на этот заголовок">¶</a></h3>
<p>Загрузка тестового образа</p>
<p><tt class="docutils literal"><span class="pre">glance</span> <span class="pre">image-create</span> <span class="pre">--name</span> <span class="pre">cirros-0.3.0</span> <span class="pre">--is-public</span> <span class="pre">true</span> <span class="pre">--container-format</span> <span class="pre">bare</span> <span class="pre">--disk-format</span> <span class="pre">qcow2</span> <span class="pre">--copy-from</span> <span class="pre">https://launchpad.net/cirros/trunk/0.3.0/+download/cirros-0.3.0-x86_64-disk.img</span></tt></p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Для тестового образа cirros-0.3.0 помимо ssh-ключа для авторизации можно использовать  логин <strong>cirros</strong> и пароль <strong>cubswin:)</strong></p>
</div>
</div>
</div>
<div class="section" id="nova">
<span id="id13"></span><h2>Nova<a class="headerlink" href="#nova" title="Ссылка на этот заголовок">¶</a></h2>
<p>Nova is the most complicated and distributed component of OpenStack. A large number of processes cooperate to turn end user API requests into running virtual machines. Below is a list of these processes and their functions:</p>
<blockquote>
<div><ul class="simple">
<li>nova-api accepts and responds to end user compute API calls. It supports OpenStack Compute API, Amazon&#8217;s EC2 API and a special Admin API (for privileged users to perform administrative actions). It also initiates most of the orchestration activities (such as running an instance) as well as enforces some policy (mostly quota checks).</li>
<li>The nova-compute process is primarily a worker daemon that creates and terminates virtual machine instances via hypervisor&#8217;s APIs (XenAPI for XenServer/XCP, libvirt for KVM or QEMU, VMwareAPI for VMware, etc.). The process by which it does so is fairly complex but the basics are simple: accept actions from the queue and then perform a series of system commands (like launching a KVM instance) to carry them out while updating state in the database.</li>
<li>nova-volume manages the creation, attaching and detaching of persistent volumes to compute instances (similar functionality to Amazon’s Elastic Block Storage). It can use volumes from a variety of providers such as iSCSI or Rados Block Device in Ceph. A new OpenStack projects, Cinder, will eventually replace nova-volume functionality. In the Folsom release, nova-volume and the Block Storage service will have similar functionality.</li>
<li>The nova-network worker daemon is very similar to nova-compute and nova-volume. It accepts networking tasks from the queue and then performs tasks to manipulate the network (such as setting up bridging interfaces or changing iptables rules). This functionality is being migrated to Quantum, a separate OpenStack service. In the Folsom release, much of the functionality will be duplicated between nova-network and Quantum.</li>
<li>The nova-schedule process is conceptually the simplest piece of code in OpenStack Nova: take a virtual machine instance request from the queue and determines where it should run (specifically, which compute server host it should run on).</li>
<li>The queue provides a central hub for passing messages between daemons. This is usually implemented with RabbitMQ today, but could be any AMPQ message queue (such as Apache Qpid). New to the Folsom release is support for Zero MQ (note: I&#8217;ve only included this so that Eric Windisch won&#8217;t be hounding me mercilessly about it&#8217;s omission).</li>
<li>The SQL database stores most of the build-time and run-time state for a cloud infrastructure. This includes the instance types that are available for use, instances in use, networks available and projects. Theoretically, OpenStack Nova can support any database supported by SQL-Alchemy but the only databases currently being widely used are sqlite3 (only appropriate for test and development work), MySQL and PostgreSQL.</li>
<li>Nova also provides console services to allow end users to access their virtual instance&#8217;s console through a proxy. This involves several daemons (nova-console, nova-vncproxy and nova-consoleauth).</li>
</ul>
</div></blockquote>
<p>Nova interacts with many other OpenStack services: Keystone for authentication, Glance for images and Horizon for web interface. The Glance interactions are central. The API process can upload and query Glance while nova-compute will download images for use in launching images.</p>
<div class="section" id="id14">
<h3>Установка<a class="headerlink" href="#id14" title="Ссылка на этот заголовок">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">nova-api</span> <span class="pre">nova-cert</span> <span class="pre">novnc</span> <span class="pre">nova-consoleauth</span> <span class="pre">nova-scheduler</span></tt></p>
<p><tt class="docutils literal"><span class="pre">mysql</span> <span class="pre">-uroot</span> <span class="pre">-pMysqlPass</span> <span class="pre">-e</span> <span class="pre">&quot;CREATE</span> <span class="pre">DATABASE</span> <span class="pre">nova;&quot;</span></tt></p>
<p>В файле /etc/nova/api-paste.ini:</p>
<div class="highlight-python"><pre>[filter:authtoken]
paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory
auth_host = 127.0.0.1
auth_port = 35357
auth_protocol = http
admin_tenant_name = admin
admin_user = admin
admin_password = cl0udAdmin
signing_dir = /tmp/keystone-signing-nova</pre>
</div>
<p>В файле /etc/nova/nova.conf:</p>
<div class="highlight-python"><pre>[DEFAULT]
logdir=/var/log/nova
state_path=/var/lib/nova
lock_path=/run/lock/nova
verbose=True
api_paste_config=/etc/nova/api-paste.ini
compute_scheduler_driver = nova.scheduler.filter_scheduler.FilterScheduler
s3_host=10.10.10.0
ec2_host=10.10.10.0
ec2_dmz_host=10.10.10.0
rabbit_host=10.10.10.0
cc_host=10.10.10.0
dmz_cidr=169.254.169.254/32
metadata_host=10.10.10.0
metadata_listen=0.0.0.0
nova_url=http://10.10.10.0:8774/v1.1/
sql_connection=mysql://root:MysqlPass@10.10.10.0/nova
ec2_url=http://10.10.10.0:8773/services/Cloud
root_helper=sudo nova-rootwrap /etc/nova/rootwrap.conf

# Auth
use_deprecated_auth=false
auth_strategy=keystone
keystone_ec2_url=http://10.10.10.0:5000/v2.0/ec2tokens
# Imaging service
glance_api_servers=10.10.10.0:9292
image_service=nova.image.glance.GlanceImageService

# Vnc configuration
novnc_enabled=true
novncproxy_base_url=http://195.208.117.140:6080/vnc_auto.html
novncproxy_port=6080
vncserver_proxyclient_address=195.208.117.140
vncserver_listen=0.0.0.0

# Network settings
network_api_class=nova.network.quantumv2.api.API
quantum_url=http://10.10.10.0:9696
quantum_auth_strategy=keystone
quantum_admin_tenant_name=service
quantum_admin_username=quantum
quantum_admin_password=service_pass
quantum_admin_auth_url=http://10.10.10.0:35357/v2.0
libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtHybridOVSBridgeDriver
linuxnet_interface_driver=nova.network.linux_net.LinuxOVSInterfaceDriver
firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver

# Compute #
compute_driver=libvirt.LibvirtDriver

# Cinder #
volume_api_class=nova.volume.cinder.API
osapi_volume_listen_port=5900</pre>
</div>
<p>Синхронизация с базой</p>
<p><tt class="docutils literal"><span class="pre">nova-manage</span> <span class="pre">db_sync</span></tt></p>
<p><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">kvm</span> <span class="pre">libvirt-bin</span> <span class="pre">pm-utils</span> <span class="pre">nova-conductor</span></tt></p>
<p>Перезапуск сервисов</p>
<p><tt class="docutils literal"><span class="pre">find</span> <span class="pre">/etc/init.d</span> <span class="pre">-name</span> <span class="pre">nova*</span> <span class="pre">-exec</span> <span class="pre">{}</span> <span class="pre">restart</span> <span class="pre">\;</span></tt></p>
<div class="admonition hint">
<p class="first admonition-title">Подсказка</p>
<p class="last">Посмотреть список работающих сервисов Nova можно командой nova-manage service list</p>
</div>
</div>
</div>
<div class="section" id="cinder">
<span id="id15"></span><h2>Cinder<a class="headerlink" href="#cinder" title="Ссылка на этот заголовок">¶</a></h2>
<p>Cinder separates out the persistent block storage functionality that was previously part of Openstack Compute (in the form of nova-volume) into it&#8217;s own service. The OpenStack Block Storage API allows for manipulation of volumes, volume types (similar to compute flavors) and volume snapshots.</p>
<blockquote>
<div><ul class="simple">
<li>cinder-api accepts API requests and routes them to cinder-volume for action.</li>
<li>cinder-volume acts upon the requests by reading or writing to the Cinder database to maintain state, interacting with other processes (like cinder-scheduler) through a message queue and directly upon block storage providing hardware or software. It can interact with a variety of storage providers through a driver architecture. Currently, there are drivers for IBM, SolidFire, NetApp, Nexenta, Zadara, linux iSCSI and other storage providers.</li>
<li>Much like nova-scheduler, the cinder-scheduler daemon picks the optimal block storage provider node to create the volume on.</li>
<li>Cinder deployments will also make use of a messaging queue to route information between the cinder processes as well as a database to store volume state.</li>
</ul>
</div></blockquote>
<p>Like Quantum, Cinder will mainly interact with Nova, providing volumes for its instances.</p>
<div class="section" id="id16">
<h3>Установка<a class="headerlink" href="#id16" title="Ссылка на этот заголовок">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">cinder-api</span> <span class="pre">cinder-scheduler</span> <span class="pre">cinder-volume</span> <span class="pre">iscsitarget</span> <span class="pre">open-iscsi</span> <span class="pre">iscsitarget-dkms</span></tt></p>
<p><tt class="docutils literal"><span class="pre">sed</span> <span class="pre">-i</span> <span class="pre">'s/false/true/g'</span> <span class="pre">/etc/default/iscsitarget</span></tt></p>
<p><tt class="docutils literal"><span class="pre">service</span> <span class="pre">iscsitarget</span> <span class="pre">start</span></tt></p>
<p><tt class="docutils literal"><span class="pre">service</span> <span class="pre">open-iscsi</span> <span class="pre">start</span></tt></p>
<p><tt class="docutils literal"><span class="pre">mysql</span> <span class="pre">-uroot</span> <span class="pre">-pMysqlPass</span> <span class="pre">-e</span> <span class="pre">&quot;CREATE</span> <span class="pre">DATABASE</span> <span class="pre">cinder;&quot;</span></tt></p>
<p>В файле /etc/cinder/api-pate.ini:</p>
<div class="highlight-python"><pre>[filter:authtoken]
paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory
service_protocol = http
service_host = 127.0.0.1
service_port = 5000
auth_host = 127.0.0.1
auth_port = 35357
auth_protocol = http
admin_tenant_name = admin
admin_user = admin
admin_password = cl0udAdmin
signing_dir = /var/lib/cinder</pre>
</div>
<p>В файле /etc/cinder/cinder.conf:</p>
<div class="highlight-python"><pre>[DEFAULT]
rootwrap_config = /etc/cinder/rootwrap.conf
sql_connection = mysql://root:MysqlPass@10.10.10.0/cinder
api_paste_confg = /etc/cinder/api-paste.ini
iscsi_helper = tgtadm
volume_name_template = volume-%s
volume_group = tn0
verbose = True
auth_strategy = keystone
state_path = /var/lib/cinder
volumes_dir = /var/lib/cinder/volumes</pre>
</div>
<div class="admonition hint">
<p class="first admonition-title">Подсказка</p>
<p class="last">Здесь tn0 - название группы логических томов lvm2</p>
</div>
<p><tt class="docutils literal"><span class="pre">cinder-manage</span> <span class="pre">db</span> <span class="pre">sync</span></tt></p>
<p><tt class="docutils literal"><span class="pre">service</span> <span class="pre">cinder-volume</span> <span class="pre">restart</span></tt></p>
<p><tt class="docutils literal"><span class="pre">service</span> <span class="pre">cinder-api</span> <span class="pre">restart</span></tt></p>
</div>
</div>
<div class="section" id="dashboard">
<span id="horizon"></span><h2>Dashboard<a class="headerlink" href="#dashboard" title="Ссылка на этот заголовок">¶</a></h2>
<p>Horizon is a modular Django web application that provides an end user and administrator interface to OpenStack services.</p>
<div class="figure">
<img alt="_images/horizon.png" src="_images/horizon.png" />
</div>
<p>As with most web applications, the architecture is fairly simple:</p>
<blockquote>
<div><ul class="simple">
<li>Horizon is usually deployed via mod_wsgi in Apache. The code itself is separated into a reusable python module with most of the logic (interactions with various OpenStack APIs) and presentation (to make it easily customizable for different sites).</li>
<li>A database (configurable as to which one). As it relies mostly on the other services for data, it stores very little data of its own.</li>
</ul>
</div></blockquote>
<p>From a network architecture point of view, this service will need to be customer accessible as well as be able to talk to each service&#8217;s public APIs. If you wish to use the administrator functionality (i.e. for other services), it will also need connectivity to their Admin API endpoints (which should not be customer accessible).</p>
<div class="section" id="id17">
<h3>Установка<a class="headerlink" href="#id17" title="Ссылка на этот заголовок">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">openstack-dashboard</span> <span class="pre">memcached</span> <span class="pre">node-less</span></tt></p>
</div>
</div>
<div class="section" id="quantum">
<span id="id18"></span><h2>Quantum<a class="headerlink" href="#quantum" title="Ссылка на этот заголовок">¶</a></h2>
<div class="figure align-center">
<img alt="_images/quantum.png" src="_images/quantum.png" />
</div>
<p>За работу с сетевой частью OpenStack отвечает библиотека Quantum, которая обеспечивает функцию «сеть как сервис» между сетевыми интерфейсами ВМ (vNIC) под управлением других сервисов OpenStack, фактически предоставляя API, позволяющее управлять всей сетевой частью облака. В зависимости от поставленных задач и спроектированной целевой конфигурации облака, к Quantum можно подключать плагины, такие как Open vSwith, Cisco UCS/Nexus, Linux Brige, NEC OpenFlow, Nicira Network Virtualization Platform (NVP) и некоторые другие.
Quantum provides &#8220;network connectivity as a service&#8221; between interface devices managed by other OpenStack services (most likely Nova). The service works by allowing users to create their own networks and then attach interfaces to them. Like many of the OpenStack services, Quantum is highly configurable due to it&#8217;s plug-in architecture. These plug-ins accommodate different networking equipment and software. As such, the architecture and deployment can vary dramatically. In the above architecture, a simple Linux networking plug-in is shown.</p>
<blockquote>
<div><ul class="simple">
<li>quantum-server accepts API requests and then routes them to the appropriate quantum plugin for action.</li>
<li>Quantum plugins and agents perform the actual actions such as plugging and unplugging ports, creating networks or subnets and IP addressing. These plugins and agents differ depending on the vendor and technologies used in the particular cloud. Quantum ships with plugins and agents for: Cisco virtual and physical switches, Nicira NVP product, NEC OpenFlow products, Open vSwitch, Linux bridging and the Ryu Network Operating System. Midokua also provides a plug-in for Quantum integration. The common agents are L3 (layer 3), DHCP (dynamic host IP addressing) and the specific plug-in agent.</li>
<li>Most Quantum installations will also make use of a messaging queue to route information between the quantum-server and various agents as well as a database to store networking state for particular plugins.</li>
</ul>
</div></blockquote>
<p>Quantum will interact mainly with Nova, where it will provide networks and connectivity for its instances.</p>
<div class="section" id="id19">
<h3>Установка<a class="headerlink" href="#id19" title="Ссылка на этот заголовок">¶</a></h3>
<blockquote>
<div>pip install cliff &#8211;upgrade</div></blockquote>
</div>
</div>
<div class="section" id="swift">
<span id="id20"></span><h2>Swift<a class="headerlink" href="#swift" title="Ссылка на этот заголовок">¶</a></h2>
<p>The swift architecture is very distributed to prevent any single point of failure as well as to scale horizontally. It includes the following components:</p>
<blockquote>
<div><ul class="simple">
<li>Proxy server (swift-proxy-server) accepts incoming requests via the OpenStack Object API or just raw HTTP. It accepts files to upload, modifications to metadata or container creation. In addition, it will also serve files or container listing to web browsers. The proxy server may utilize an optional cache (usually deployed with memcache) to improve performance.</li>
<li>Account servers manage accounts defined with the object storage service.</li>
<li>Container servers manage a mapping of containers (i.e folders) within the object store service.</li>
<li>Object servers manage actual objects (i.e. files) on the storage nodes.</li>
<li>There are also a number of periodic process which run to perform housekeeping tasks on the large data store. The most important of these is the replication services, which ensures consistency and availability through the cluster. Other periodic processes include auditors, updaters and reapers.</li>
</ul>
</div></blockquote>
<p>The object store can also serve static web pages and objects via HTTP. In fact, the diagrams in this blog post are being served out of Rackspace Cloud&#8217;s Swift service.</p>
<p>Authentication is handled through configurable WSGI middleware (which will usually be Keystone).</p>
<div class="section" id="id21">
<h3>Установка<a class="headerlink" href="#id21" title="Ссылка на этот заголовок">¶</a></h3>
</div>
</div>
<div class="section" id="munin">
<span id="id22"></span><h2>Munin<a class="headerlink" href="#munin" title="Ссылка на этот заголовок">¶</a></h2>
</div>
<div class="section" id="names">
<span id="id23"></span><h2>MyDNS<a class="headerlink" href="#names" title="Ссылка на этот заголовок">¶</a></h2>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Наверх</a>
    </p>
    <p>
        &copy; 2013, Леонид Лабошин.<br/>
    </p>
  </div>
</footer>
  </body>
</html>